-- 100万円まで対応のメルカリ用価格表作成SQL
-- Supabase SQL Editorで実行してください

-- 1. メルカリ用価格表作成
INSERT INTO flea_market_research_price_tables (
    name,
    description,
    is_active
) VALUES (
    'メルカリ用価格表_100万円対応',
    'メルカリ向けの固定価格設定（100万円まで対応・手数料10%）',
    true
);

-- 2. 作成した価格表のIDを取得して価格範囲を追加（100万円まで対応）
WITH new_table AS (
    SELECT id FROM flea_market_research_price_tables 
    WHERE name = 'メルカリ用価格表_100万円対応'
    ORDER BY created_at DESC 
    LIMIT 1
)
INSERT INTO flea_market_research_price_ranges (
    price_table_id,
    min_price,
    max_price,
    fixed_price,
    profit_rate,
    shipping_cost,
    platform_fee_rate
)
SELECT 
    new_table.id,
    ranges.min_price,
    ranges.max_price,
    ranges.fixed_price,
    0,    -- profit_rate (デフォルト値)
    175,  -- shipping_cost (デフォルト値)
    10.0  -- platform_fee_rate (メルカリの手数料)
FROM new_table
CROSS JOIN (
    VALUES 
        -- 100万円まで細かく分割した価格範囲（最小価格の2倍を固定価格）
        (0, 999, 0),                      -- ¥0-¥999 → ¥0
        (1000, 1999, 2000),               -- ¥1,000-¥1,999 → ¥2,000
        (2000, 2999, 4000),               -- ¥2,000-¥2,999 → ¥4,000
        (3000, 4999, 6000),               -- ¥3,000-¥4,999 → ¥6,000
        (5000, 7999, 10000),              -- ¥5,000-¥7,999 → ¥10,000
        (8000, 9999, 16000),              -- ¥8,000-¥9,999 → ¥16,000
        (10000, 14999, 20000),            -- ¥10,000-¥14,999 → ¥20,000
        (15000, 19999, 30000),            -- ¥15,000-¥19,999 → ¥30,000
        (20000, 29999, 40000),            -- ¥20,000-¥29,999 → ¥40,000
        (30000, 39999, 60000),            -- ¥30,000-¥39,999 → ¥60,000
        (40000, 49999, 80000),            -- ¥40,000-¥49,999 → ¥80,000
        (50000, 59999, 100000),           -- ¥50,000-¥59,999 → ¥100,000
        (60000, 69999, 120000),           -- ¥60,000-¥69,999 → ¥120,000
        (70000, 79999, 140000),           -- ¥70,000-¥79,999 → ¥140,000
        (80000, 99999, 160000),           -- ¥80,000-¥99,999 → ¥160,000
        (100000, 149999, 200000),         -- ¥100,000-¥149,999 → ¥200,000
        (150000, 199999, 300000),         -- ¥150,000-¥199,999 → ¥300,000
        (200000, 249999, 400000),         -- ¥200,000-¥249,999 → ¥400,000
        (250000, 299999, 500000),         -- ¥250,000-¥299,999 → ¥500,000
        (300000, 349999, 600000),         -- ¥300,000-¥349,999 → ¥600,000
        (350000, 399999, 700000),         -- ¥350,000-¥399,999 → ¥700,000
        (400000, 449999, 800000),         -- ¥400,000-¥449,999 → ¥800,000
        (450000, 499999, 900000),         -- ¥450,000-¥499,999 → ¥900,000
        (500000, 549999, 1000000),        -- ¥500,000-¥549,999 → ¥1,000,000
        (550000, 599999, 1100000),        -- ¥550,000-¥599,999 → ¥1,100,000
        (600000, 649999, 1200000),        -- ¥600,000-¥649,999 → ¥1,200,000
        (650000, 699999, 1300000),        -- ¥650,000-¥699,999 → ¥1,300,000
        (700000, 749999, 1400000),        -- ¥700,000-¥749,999 → ¥1,400,000
        (750000, 799999, 1500000),        -- ¥750,000-¥799,999 → ¥1,500,000
        (800000, 849999, 1600000),        -- ¥800,000-¥849,999 → ¥1,600,000
        (850000, 899999, 1700000),        -- ¥850,000-¥899,999 → ¥1,700,000
        (900000, 949999, 1800000),        -- ¥900,000-¥949,999 → ¥1,800,000
        (950000, 999999, 1900000),        -- ¥950,000-¥999,999 → ¥1,900,000
        (1000000, 1000000, 2000000)       -- ¥1,000,000 → ¥2,000,000
) AS ranges(min_price, max_price, fixed_price);

-- 3. 作成結果確認
SELECT 
    pt.name,
    pr.min_price,
    pr.max_price,
    pr.fixed_price,
    CASE 
        WHEN pr.min_price = 0 THEN 0
        ELSE ROUND((pr.fixed_price::numeric / pr.min_price) - 1, 2) * 100
    END as price_multiplier_percent,
    pr.shipping_cost,
    pr.platform_fee_rate
FROM flea_market_research_price_tables pt
JOIN flea_market_research_price_ranges pr ON pt.id = pr.price_table_id
WHERE pt.name = 'メルカリ用価格表_100万円対応'
ORDER BY pr.min_price;